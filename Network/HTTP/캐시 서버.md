웹 캐시 : 자주 쓰이는 문서의 사본을 자동으로 저장하는 HTTP 장치. 불필요한 전송을 줄여 부하를 줄이고 병목 현상 또한 줄여준다.

또한 갑작스럽게 요청이 쇄도하게 될 때 대처할 수 있으며 거리로 인한 지연에 효과적이다. 

캐시는 언제든지 서버로부터 사본을 재검사할 수 있다. 검사가 필요할 정도로 오래된 사본이라고 판단되면 신선도 검사를 통해 사본을 교체한다. 변경이 필요없다면 304 Not Modified를 서버가 캐시로 보내서 사본이 신선하다고 다시 표시한다. GET 요청 시 헤더에 If-Modified-Since를 추가하면 캐시된 이후에 변경된 경우에만 사본을 보내라는 의미가 된다.

캐시 토폴로지

    개인 전용 캐시 : 작고 저렴함. 웹브라우저는 개인 전용 캐시를 내장하고 있다. 익스플로러는 캐시된 문서를 '임시 파일'이라고 부른다.

    공용 프록시 캐시 : 로컬 캐시에서 문서 제공, 여러 사용자가 접근하여 불필요한 트래픽을 줄일 수 있음. 

캐시 처리 단계

    1. 요청 받기 : 캐시가 네트워크로부터 요청 메시지를 읽음

    2. 파싱 : 캐시가 메시지를 파싱하여 URL과 헤더를 추출

    3. 검색 : 캐시는 로컬 복사본 유무를 검사하고 사본이 없다면 사본을 원 서버로부터 받아온다.

    4. 신선도 검사 : 캐시는 캐시된 사본이 충분히 신선한지 검사하고 신선하지 않다면 변경사항이 있는지 서버에게 물어본다. 변경사항이 있다면 서버로부터 사본을 받아와서 신선도를 유지한다.

    5. 응답 생성 : 캐시는 새로운 헤더와 캐시된 본문으로 응답 메시지를 만든다.

    6. 발송 : 캐시는 네트워크를 통해 응답을 클라이언트에게 돌려준다.

    7. 로깅 : 캐시는 로그파일에 트랜잭션의 로그를 기록한다.

신선도 유지

    HTTP는 Cache-Control과 Expires라는 헤더로 원 서버가 각 문서에 유효기간을 붙일 수 있게 해준다.
    
    Cache-Control: max-age - 문서의 최대 나이 설정. 생성된 시점부터 더 이상 신선하다고 간주되지 않을 때까지의 최대 시간

    Expires : 절대적 유효 기간. 유효기간을 경과하면 신선하지 않다고 판단한다.

    서버 재검사 : 문서가 만료되었다는 것은 다르다는 것이 아니라 재검사가 필요하다는 것을 의미한다. 원 서버에 문서 변경 여부를 물어본다.
    변경되었다면 캐시는 새로운 사본을 가져와 저장하고 클라이언트로 보내고, 변경되지 않았다면 만료일을 다시 재설정하고 새로운 헤더들을 가져와서 캐시 안의 헤더들을 갱신한다.

    캐시 재검사를 위해 쓰이는 대표적인 헤더로 If-Modified-Since와 If-None-Match이다.

    If-Modified-Since: <date> - 문서가 date에 해당하는 날짜 이후로 수정되었다면 요청 메서드를 처리한다. Last-Modified와 함께 사용된다.

    If-None-Match: <tage> - 캐시된 태그가 서버에 있는 문서의 태그와 다를 때만 요청을 처리한다. 변경일시를 명확하게 판별할 수 없고 작은 간격으로 변경되는 문서나 실제로는 문서에 아무런 영향을 주지않는 변화만이 있을 경우, 태그를 사용하여 버전 등을 표시하여 재검사 유무를 판별할 수 있다.

엔티티 태그 vs Last-Modified : 서버가 태그를 반환하면 반드시 태그 검사기를 사용하고, 서버가 Last-Modified를 반환하면 If-Modified-Since 검사를 사용한다.

no-cache와 no-store : 캐시가 검증되지 않은 객체를 응답하는 것을 막는다. 
no-store는 캐시가 응답의 사본을 만드는 것을 금지한다. 
no-cache는 캐시에 저장될 수 있지만 재검사를 하지 않으면 클라이언트에 제공하는 것을 막는다.