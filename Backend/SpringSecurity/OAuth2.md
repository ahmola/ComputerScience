Open Authenticaion 2.0, 줄여서 OAuth2라고 불린다.

모든 요청에 자격 증명을 보내게 되면 자격 증명이 자주 공유하고 클라이언트(브라우저 등)이 사용자 정보를 기록하게 되어 보안 및 최적화에 좋지 않다.

그렇기 때문에 별도의 시스템을 통해서 사용자의 자격 증명을 관리하는 것이 바람직하다.

권한 부여 서버를 별도로 격리하여 비즈니스에 포함된 모든 앱들이 권한 부여 서버를 이용해 사용자를 인증하는 것이 관리하기 쉽다.

OAuth2의 구성 요소

    리소스 서버 : 사용자의 리소스를 호스팅한다. 리소스는 정보 또는 사용자가 행한 작업 등을 가리킨다.

    사용자 : 리소스를 소유한 개인. 이름과 암호로 신원을 증명함

    클라이언트 : 사용자를 대신해서 리소스에 접근하는 애플리케이션(주로 브라우저). 클라이언트는 클라이언트 id와 비밀번호를 가지며
    별도의 자체 자격 증명을 요구받는다.

    권한 부여 서버 : 리소스에 접근할 권한을 부여하는 애플리케이션. 사용자 대신 리소스에 접근할 권한이 있다고 판단되는 클라이언트에게 토큰을 발급한다.
    발급받은 토큰으로 클라이언트는 리소스 서버에서 증명받고 리소스에 접근한다.

OAuth2는 grant라는 토큰을 사용한다. 승인 코드, 암호, 갱신 토큰, 클라이언트 자격 증명을 통해 grant를 발급받을 수 있다.

OAuth2 구현 유형

- 승인 코드 그랜트 유형 

    1. 사용자가 클라이언트에 리소스 요청

    2. 클라이언트가 자격 증명을 요청

    3. 사용자가 클라이언트에게 토큰을 발급하도록 자신의 자격 증명을 통해 권한 부여 서버에 요청함(이 때 클라이언트가 로그인 페이지를 제공함).
    
    4. 권한 부여 서버가 실제 올바른 클라이언트가 맞는지 클라이언트가 자체 자격 증명한 후, 클라이언트가 권한 부여 서버로부터 액세스 토큰 흭득

    5. 클라이언트가 흭득한 토큰으로 리소스 서버에 접속하여 사용자가 요청한 리소스를 받아옴

- 암호 그랜트 유형 : 클라이언트가 사용자 자격 증명을 수집하고 이를 사용해 인증하여 권한 부여 서버에서 액세스 토큰을 얻음.

클라이언트와 권한 부여 서버를 같은 조직에서 구축하고 유지 관리할 때만 이용한다. 자격 증명을 클라이언트와 공유해야하므로 클라이언트를 신뢰할 때만 가능하다.

    1. 사용자가 클라이언트에게 리소스 요청과 자격 증명 전송

    2. 클라이언트는 사용자의 자격 증명과 함께 권한 부여 서버에 토큰 요청

    3. 권한 부여 서버가 인증하고 토큰을 클라이언트에게 발급함

    4. 클라이언트가 발급받은 토큰으로 리소스 서버에 리소스를 요청하고 받아옴

- 클라이언트 자격 증명 그랜트 유형 : 두 앱 간의 인증 구현 시에 사용. 암호 그랜트 + API 키 인증의 조합과 비슷

    1. 리소스에 접근하기 위한 토큰을 발급받기 위해 권한 부여 서버에 클라이언트 자격 증명을 보냄. 이 때, 사용자를 대신하는 것이 아님

    2. 클라이언트가 발급받은 토큰으로 리소스 서버에 리소스 요청

    3. 리소스가 토큰이 유효한지 확인 후 리소스를 클라이언트에게 보냄

토큰의 수명은 항상 짧게 유지하며 수명이 다 되면 재발급읕 받아야한다. 그러나 토큰 수명이 짧은데 재발급을 계속 요구하면 사용자 경험의 질이 낮아지므로
(계속해서 자격 증명, 즉 로그인을 요구하므로)

갱신 토큰을 발급받아서 인증 토큰이 만료되면 갱신 토큰으로 자격 증명을 대신하여 인증 토큰을 재발급받는다.

클라이언트 자격 증명 그랜트 유형은 사용자가 없으므로 해당되지 않는다.

OAtuh2의 단점

    1. CSRF(사이트 간 요청 위조) 악용 가능성이 있다. CSRF 보호 메커니즘이 없다면 CSRF가 가능하다.

    2. 보호되지 않은 자격 증명을 저장하거나 전송하면 악용될 수 있음

    3. 누군가가 네트워크에서 토큰을 가로챌 수 있다.

    4. 인증 프로세스를 방해하고 토큰을 훔칠 수 있다. 이는 갱신 토큰을 가로챌 때 특히 취약하다.