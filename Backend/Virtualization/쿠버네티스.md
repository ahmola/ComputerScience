오케스트레이션 : 컨테이너의 운영 및 관리를 자동화하는 기술

모놀리식 아키텍쳐의 한계를 극복하기 위해 마이크로서비스 아키텍쳐가 등장하였다.

이 과정에서 마이크로서비스 아키텍쳐를 위한 컨테이너라는 격리된 프로세스의 개념이 만들어졌고,

이를 생성 및 관리하기 위한 가상화 소프트웨어로 Docker를 사용한다.

하나의 서비스를 여러 마이크로서비스로 분할하고 이를 도커의 이미지를 통해 컨테이너화하여 관리한다.

서비스가 더 커져감에 따라, 컨테이너의 수가 많아지고 좀 더 효율적인 관리가 요구됨에 따라 오케스트레이션의 필요성이 부각되었다.

서비스 관리에는 각 컨테이너에 클러스터링, 로드 밸런싱(요청 분산), 스케일링, 로그 분석 등 다양한 관리가 필요한데 이를 위해 쿠버네티스라는 오케스트레이션 소프트웨어가 탄생하였다.

Kubernetes는 이러한 오케스트레이션을 자동화하는 도구이다.

쿠버네티스는 컨테이너 오케스트레이션, 자동 스케일링, 자체 복구, 로드밸런싱, 스토리지 관리, 기밀 보장 등을 제공한다.

    pod : 쿠버네티스에서 최소 실행 단위로, 하나 이상의 컨테이너를 포함한 IP 주소 할당, 복제와 스케일링 등을 묶어서 관리한다.

    쿠버네티스가 직접 컨테이너를 관리하지 않고, 노드를 통해서 팟을 관리하게 된다.

    일반적으로 디자인 패턴의 설계 패턴에 의해 1파드=1컨테이너로, 엄밀히 말하면 파드는 컨테이너가 아니지만 그렇게 봐도 무방하다.

    보조적인 역할을 위해 파드 안에 사이드카 컨테이너로 2개가 들어가는 경우가 있다.

    쉽게 예를 들면, 컨테이너가 자동차면 파드는 차고에 가깝다.

    replicaset : 쿠버네티스에서 파드를 관리하는 단위로, 파드의 복제를 지정한 수만큼 유지한다.
    
    같은 유형의 파드만 포함할 수 있다.

    deployment : 한 개 이상의 레플리카셋을 그룹화하는 관리 단위로, 레플리카셋의 파드 수를 증감하거나 레플리카셋을 생성한다.

    같은 레플리카셋의 다른 버전을 포함하는 것이 일반적이다.

    controller : 현 상태에서 목표로 설정한 상태로 만드는 메커니즘이다.
    
    레플리카셋이나 디플로이먼트가 설정한 상태와 차이가 난다면, 설정 상태에 맞춰 파드 수를 증감시키거나 레플리카셋을 만든다.

    디플로이먼트 컨트롤러의 경우, 파드의 변화가 없고 수적인 변화만 있을 경우 레플리카셋의 파드 수를 업데이트하고

    파드의 변화가 있다면, 새로운 레플리카셋을 만들고 이전 레플리카셋의 수를 0으로 만든다.

    디플로이먼트로 배포와 관리를 쉽게 할 수 있다.

    node : 파드를 실제로 실행하는 가상 머신으로, 쿠버네티스 클러스터를 구성하는 리소스 단위이다.

    물리 머신이거나 가상 머신일 수 있다.

    파드를 실행하는데 필요한 모든 환경을 제공한다.

    즉, 클러스터 내 여러 노드가 있고, 노드 내에는 여러 파드(컨테이너)가 존재한다.

    노드가 직접 관리하는 것이 아닌 쿠버네티스의 컨트롤 플레인에 의해서 스케쥴링된다.

    service : 파드 내 컨테이너에 접속하기 위한 엔드포인트를 제공하는 네트워크 방식이다.

    엔드포인트를 통해서 컨테이너에 간접적으로 접속하는데, 쿠버네티스에서는 레플리카셋과 디플로이먼트에 의해

    파드의 실행과 정지가 유기적으로 이뤄지기 때문에, 정확한 접속을 위해 만들어진 것이 서비스이다.
    
    사용자가 엔드포인트의 가상 IP 주소에 접속하면 요청한 서비스에 맞게 해당 파드의 컨테이너로 로드 밸런싱이 이루어진다.

    같은 파드 내 컨테이너들은 네임스페이스를 공유하므로 로컬호스트에 접속하면 연결이 가능하다.

    파드가 다른 경우, 파드에는 고유 IP 주소가 있어서 IP주소에 접속하면 외부에서 접속이 가능하다.

    flanneld : 클러스터 내 다른 컴퓨터의 파드와 통신하기 위한 네트워크 구축 기술. IPv4 네트워크를 구축하여 외부 파드와 통신한다.

    클러스터 내 각 파드가 독립적인 네트워크를 구성하여 격리되어 네트워크 간 충돌을 방지한다.

    load balencing : 요청을 컨테이너들에 적절히 분배하여 부하를 분산함.

    health check : 컨테이너의 상태 감지

    availability : 사용자가 원할 때 서비스를 이용할 수 있는 정도, 가동률을 통해 평가할 수 있으며
    
        가동률 : (시스템 정상 작동 시간) / (시스템 가동 시간)

쿠버네티스 구성 요소 : master node와 worker node로 구성된다.

    master node : 컨트롤 영역을 담당하며 워커 노드를 관리한다.

    1. kube-api-server : 쿠버네티스 중심 컴포넌트, 워커가 클러스터와 통신하는 엔드포인트 제공(REST API)

    2. kube-controller-manager : 클러스터 상태 관리
        노드 컨트롤러 : 노드 상태 관리

        레플리카 컨트롤러 : 지정된 수의 파드 유지

        앤드포인트 컨트롤러 : 서비스와 파드 연결

        클라우드 컨트롤러 : 클라우드 제공자 통합

    3. kube-scheduler : 실행할 파드를 클러스터 내 적절한 노드에 할당

    4. ETCD : 분산 키-값 저장소, 클러스터의 모든 데이터 저장

    워커 노드

    1. kublet : 노드에서 실행되는 에이전트, 마스터 노드와 통신하며 관리

    2. 컨테이너 런타임 : 컨테이너를 실행하는 소프트웨어로, docker가 그 예이다. 인터페이스로 kublet과 통신함

    3. kube-proxy : 네트워크 프록시 역할을 하며, 클러스터 내 라우팅 및 네트워크 프로토콜 관리

    4. iptables : 가상 ip 주소를 변환한다.

    Helm : 쿠버네티스 패키지 매니저로, 애플리케이션 배포와 관리를 단순화한다.
